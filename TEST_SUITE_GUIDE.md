# SmellPin API å…¨é¢æµ‹è¯•å¥—ä»¶

## æ¦‚è¿°

ä¸ºSmellPiné¡¹ç›®åˆ›å»ºçš„å®Œæ•´APIæµ‹è¯•å¥—ä»¶ï¼Œæ¶µç›–äº†åç«¯æœåŠ¡çš„æ‰€æœ‰ä¸»è¦åŠŸèƒ½å’Œå®‰å…¨æ€§æµ‹è¯•ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–
```bash
npm install
```

### è¿è¡Œå…¨éƒ¨æµ‹è¯•
```bash
node run-comprehensive-tests.js --report
```

### è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
```bash
# ç”¨æˆ·è®¤è¯æµ‹è¯•
node run-comprehensive-tests.js --suite=auth --verbose

# å®‰å…¨æ€§æµ‹è¯•
node run-comprehensive-tests.js --suite=security --report

# æ€§èƒ½æµ‹è¯•
node run-comprehensive-tests.js --suite=performance
```

## ğŸ“‹ æµ‹è¯•å¥—ä»¶ç»„æˆ

### 1. ç”¨æˆ·è®¤è¯APIæµ‹è¯• (`auth`)
- âœ… ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æµ‹è¯•
- âœ… ç”¨æˆ·ç™»å½•éªŒè¯
- âœ… JWTä»¤ç‰Œç”Ÿæˆå’ŒéªŒè¯
- âœ… å¯†ç é‡ç½®æµç¨‹
- âœ… ä¼šè¯ç®¡ç†
- âœ… æƒé™éªŒè¯

**è¦†ç›–ç«¯ç‚¹ï¼š**
- `POST /api/v1/users/register`
- `POST /api/v1/users/login`
- `POST /api/v1/users/logout`
- `GET /api/v1/users/profile/me`
- `PUT /api/v1/users/profile`

### 2. LBSç›¸å…³APIæµ‹è¯• (`lbs`)
- âœ… GPSä½ç½®æ•°æ®ä¸ŠæŠ¥
- âœ… åœ°ç†å›´æ æ£€æµ‹ç®—æ³•
- âœ… è·ç¦»è®¡ç®—å‡†ç¡®æ€§
- âœ… å¥–åŠ±è®¡ç®—é€»è¾‘
- âœ… GPSæ¬ºéª—æ£€æµ‹
- âœ… é«˜é¢‘ä½ç½®æ›´æ–°å¤„ç†

**è¦†ç›–ç«¯ç‚¹ï¼š**
- `POST /api/v1/lbs/location`
- `POST /api/v1/lbs/geofence/check`
- `POST /api/v1/lbs/rewards/discover`
- `GET /api/v1/lbs/rewards/stats`

### 3. æ°”å‘³æ ‡è®°APIæµ‹è¯• (`annotations`)
- âœ… æ ‡æ³¨åˆ›å»ºå’ŒéªŒè¯
- âœ… åœ°ç†ç©ºé—´æŸ¥è¯¢
- âœ… æ ‡æ³¨CRUDæ“ä½œ
- âœ… å›¾ç‰‡ä¸Šä¼ å¤„ç†
- âœ… æ ‡æ³¨äº’åŠ¨ï¼ˆç‚¹èµã€è¯„è®ºï¼‰
- âœ… å†…å®¹å®¡æ ¸å’Œè¿‡æ»¤

**è¦†ç›–ç«¯ç‚¹ï¼š**
- `POST /api/v1/annotations`
- `GET /api/v1/annotations/list`
- `GET /api/v1/annotations/nearby`
- `PUT /api/v1/annotations/:id`
- `DELETE /api/v1/annotations/:id`

### 4. æ”¯ä»˜APIæµ‹è¯• (`payments`)
- âœ… Stripeæ”¯ä»˜é›†æˆ
- âœ… æ”¯ä»˜æ„å›¾åˆ›å»º
- âœ… æ”¯ä»˜ç¡®è®¤æµç¨‹
- âœ… Webhookå¤„ç†
- âœ… é€€æ¬¾å¤„ç†
- âœ… æ”¯ä»˜å®‰å…¨éªŒè¯

**è¦†ç›–ç«¯ç‚¹ï¼š**
- `POST /api/v1/payments/create-intent`
- `POST /api/v1/payments/confirm`
- `POST /api/v1/payments/webhook`
- `POST /api/v1/payments/refund`
- `GET /api/v1/payments/history`

### 5. æ•°æ®åº“æ“ä½œæµ‹è¯• (`database`)
- âœ… CRUDæ“ä½œéªŒè¯
- âœ… äº‹åŠ¡å¤„ç†æµ‹è¯•
- âœ… çº¦æŸéªŒè¯
- âœ… åœ°ç†ç©ºé—´æŸ¥è¯¢æ€§èƒ½
- âœ… å¹¶å‘æ“ä½œå®‰å…¨æ€§
- âœ… è¿æ¥æ± ç®¡ç†

### 6. WebSocketæµ‹è¯• (`websocket`)
- âœ… å®æ—¶è¿æ¥å»ºç«‹
- âœ… æ¶ˆæ¯ä¼ é€’éªŒè¯
- âœ… ç”¨æˆ·è®¤è¯
- âœ… æˆ¿é—´ç®¡ç†
- âœ… æ–­çº¿é‡è¿
- âœ… å¹¶å‘è¿æ¥å¤„ç†

### 7. å®‰å…¨æ€§æµ‹è¯• (`security`)
- âœ… SQLæ³¨å…¥é˜²æŠ¤
- âœ… XSSæ”»å‡»é˜²æŠ¤
- âœ… CSRFä¿æŠ¤
- âœ… JWTå®‰å…¨æ€§
- âœ… è¾“å…¥éªŒè¯
- âœ… æƒé™ç»•è¿‡æ£€æµ‹

### 8. æ€§èƒ½æµ‹è¯• (`performance`)
- âœ… APIå“åº”æ—¶é—´æµ‹è¯•
- âœ… å¹¶å‘è¯·æ±‚å¤„ç†
- âœ… å†…å­˜ä½¿ç”¨ç›‘æ§
- âœ… æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- âœ… è´Ÿè½½æµ‹è¯•
- âœ… AutoCannonåŸºå‡†æµ‹è¯•

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåä¼šè‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹æŠ¥å‘Šï¼š

### JSONæŠ¥å‘Š
- ä½ç½®ï¼š`tests/reports/test-report-{timestamp}.json`
- åŒ…å«è¯¦ç»†çš„æµ‹è¯•ç»Ÿè®¡æ•°æ®
- é€‚ç”¨äºCI/CDé›†æˆå’Œè‡ªåŠ¨åŒ–åˆ†æ

### HTMLæŠ¥å‘Š
- ä½ç½®ï¼š`tests/reports/test-report-{timestamp}.html`
- å¯è§†åŒ–æµ‹è¯•ç»“æœ
- åŒ…å«å›¾è¡¨å’Œäº¤äº’å¼æ•°æ®
- é€‚ç”¨äºå›¢é˜ŸæŸ¥çœ‹å’Œåˆ†äº«

## ğŸ› ï¸ æµ‹è¯•å·¥å…·å’Œæ¡†æ¶

### æ ¸å¿ƒæ¡†æ¶
- **Jest** - ä¸»è¦æµ‹è¯•æ¡†æ¶
- **Supertest** - HTTPæ¥å£æµ‹è¯•
- **Socket.io-client** - WebSocketæµ‹è¯•
- **Autocannon** - è´Ÿè½½æµ‹è¯•

### è¾…åŠ©å·¥å…·
- **Faker** - æµ‹è¯•æ•°æ®ç”Ÿæˆ
- **TestMetrics** - æ€§èƒ½æŒ‡æ ‡æ”¶é›†
- **TestDataFactory** - æµ‹è¯•æ•°æ®å·¥å‚

## ğŸ”§ é…ç½®æ–‡ä»¶

```
jest.backend.config.js     # åç«¯æµ‹è¯•é…ç½®
jest.frontend.config.js    # å‰ç«¯æµ‹è¯•é…ç½®
jest.e2e.config.js         # E2Eæµ‹è¯•é…ç½®
jest.integration.config.js # é›†æˆæµ‹è¯•é…ç½®
```

## ğŸ“ˆ æµ‹è¯•æŒ‡æ ‡

### è¦†ç›–ç‡ç›®æ ‡
- ä»£ç è¦†ç›–ç‡: â‰¥ 80%
- åˆ†æ”¯è¦†ç›–ç‡: â‰¥ 80%
- å‡½æ•°è¦†ç›–ç‡: â‰¥ 80%
- è¡Œè¦†ç›–ç‡: â‰¥ 80%

### æ€§èƒ½åŸºå‡†
- APIå“åº”æ—¶é—´: < 200ms (95th percentile)
- æ•°æ®åº“æŸ¥è¯¢: < 100ms (å¹³å‡)
- å¹¶å‘å¤„ç†: 100+ req/s
- WebSocketå»¶è¿Ÿ: < 50ms

### å®‰å…¨æ ‡å‡†
- SQLæ³¨å…¥é˜²æŠ¤: 100%
- XSSé˜²æŠ¤: 100%
- è®¤è¯ç»•è¿‡: 0 vulnerabilities
- æ•æ„Ÿæ•°æ®æ³„éœ²: 0 incidents

## ğŸ¯ æœ€ä½³å®è·µ

### æµ‹è¯•ç¼–å†™è§„èŒƒ
1. **Arrange-Act-Assertæ¨¡å¼**
2. **æè¿°æ€§æµ‹è¯•åç§°**
3. **ç‹¬ç«‹çš„æµ‹è¯•ç”¨ä¾‹**
4. **é€‚å½“çš„æµ‹è¯•æ•°æ®**
5. **æ¸…ç†æµ‹è¯•ç¯å¢ƒ**

### CI/CDé›†æˆ
```bash
# å¿«é€Ÿæµ‹è¯•ï¼ˆç”¨äºPRæ£€æŸ¥ï¼‰
npm run test:unit:quick

# å®Œæ•´æµ‹è¯•ï¼ˆç”¨äºå‘å¸ƒå‰ï¼‰
npm run test:comprehensive

# å®‰å…¨æµ‹è¯•ï¼ˆç”¨äºå®‰å…¨å®¡è®¡ï¼‰
npm run test:security
```

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# æµ‹è¯•ç¯å¢ƒ
NODE_ENV=test
TEST_DB_HOST=localhost
TEST_DB_NAME=smellpin_test
TEST_REDIS_DB=15

# JWTæµ‹è¯•å¯†é’¥
JWT_SECRET=test-secret-key

# Stripeæµ‹è¯•å¯†é’¥
STRIPE_SECRET_KEY=sk_test_...
```

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: æµ‹è¯•è¿è¡Œé€Ÿåº¦æ…¢æ€ä¹ˆåŠï¼Ÿ
**A:** 
- ä½¿ç”¨ `--suite=` å‚æ•°è¿è¡Œç‰¹å®šæµ‹è¯•
- å¯ç”¨Jestå¹¶è¡Œæ‰§è¡Œ
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢å’Œè¿æ¥

### Q2: å¦‚ä½•æ¨¡æ‹Ÿå¤–éƒ¨æœåŠ¡ï¼Ÿ
**A:**
- ä½¿ç”¨Jest mockåŠŸèƒ½
- åˆ›å»ºæµ‹è¯•ä¸“ç”¨çš„æœåŠ¡å®ä¾‹
- ä½¿ç”¨TestContainersè¿›è¡Œé›†æˆæµ‹è¯•

### Q3: å¦‚ä½•å¤„ç†å¼‚æ­¥æ“ä½œæµ‹è¯•ï¼Ÿ
**A:**
- ä½¿ç”¨async/awaitè¯­æ³•
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- æ­£ç¡®å¤„ç†Promiseå’Œå›è°ƒ

### Q4: æ•°æ®åº“æµ‹è¯•æ•°æ®å¦‚ä½•ç®¡ç†ï¼Ÿ
**A:**
- ä½¿ç”¨æµ‹è¯•ä¸“ç”¨æ•°æ®åº“
- æ¯ä¸ªæµ‹è¯•åæ¸…ç†æ•°æ®
- ä½¿ç”¨äº‹åŠ¡å›æ»šæœºåˆ¶

## ğŸ“š æ‰©å±•èµ„æº

### ç›¸å…³æ–‡æ¡£
- [Jestå®˜æ–¹æ–‡æ¡£](https://jestjs.io/docs/getting-started)
- [Supertestä½¿ç”¨æŒ‡å—](https://github.com/visionmedia/supertest)
- [Node.jsæµ‹è¯•æœ€ä½³å®è·µ](https://github.com/goldbergyoni/nodebestpractices#-5-testing-and-overall-quality-practices)

### æµ‹è¯•ç­–ç•¥
- **å•å…ƒæµ‹è¯•**: æµ‹è¯•ç‹¬ç«‹å‡½æ•°å’Œæ¨¡å—
- **é›†æˆæµ‹è¯•**: æµ‹è¯•æ¨¡å—é—´äº¤äº’
- **ç«¯åˆ°ç«¯æµ‹è¯•**: æµ‹è¯•å®Œæ•´ç”¨æˆ·æµç¨‹
- **æ€§èƒ½æµ‹è¯•**: éªŒè¯ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- **å®‰å…¨æµ‹è¯•**: æ£€æµ‹æ½œåœ¨å®‰å…¨æ¼æ´

## ğŸ¤ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•
1. åœ¨å¯¹åº”æµ‹è¯•å¥—ä»¶ä¸­æ·»åŠ æµ‹è¯•ç”¨ä¾‹
2. æ›´æ–°æµ‹è¯•æ•°æ®å·¥å‚ï¼ˆå¦‚éœ€è¦ï¼‰
3. è¿è¡Œæµ‹è¯•ç¡®ä¿é€šè¿‡
4. æ›´æ–°æ–‡æ¡£å’ŒæŒ‡æ ‡

### æŠ¥å‘Šé—®é¢˜
- æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- åŒ…å«å¤ç°æ­¥éª¤
- æ³¨æ˜æµ‹è¯•ç¯å¢ƒä¿¡æ¯

---

## ğŸ“ è”ç³»ä¿¡æ¯

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–åœ¨é¡¹ç›®ä»“åº“ä¸­åˆ›å»ºIssueã€‚

**æµ‹è¯•å¥—ä»¶ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025-09-02  
**ç»´æŠ¤è€…**: SmellPinå¼€å‘å›¢é˜Ÿ