# SmellPin ç¤¾äº¤äº’åŠ¨åŠŸèƒ½æ–‡æ¡£

## æ¦‚è¿°

SmellPin é¡¹ç›®å·²æˆåŠŸé›†æˆå®Œå–„çš„ç¤¾äº¤äº’åŠ¨åŠŸèƒ½ï¼Œæ—¨åœ¨æå‡ç”¨æˆ·ç²˜æ€§å’Œå®ç°ç—…æ¯’å¼å¢é•¿ã€‚æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†æ‰€æœ‰æ–°å¢çš„ç¤¾äº¤åŠŸèƒ½åŠå…¶æŠ€æœ¯å®ç°ã€‚

## åŠŸèƒ½æ¦‚è§ˆ

### 1. ç”¨æˆ·å…³æ³¨ç³»ç»Ÿ ğŸ‘¥
- âœ… å…³æ³¨/å–æ¶ˆå…³æ³¨ç”¨æˆ·
- âœ… ç²‰ä¸åˆ—è¡¨å’Œå…³æ³¨åˆ—è¡¨æŸ¥çœ‹
- âœ… å…±åŒå…³æ³¨è€…æ¨è
- âœ… å…³æ³¨çŠ¶æ€å®æ—¶æ›´æ–°

**APIç«¯ç‚¹:**
- `POST /api/v1/social/follow/:userId` - å…³æ³¨ç”¨æˆ·
- `DELETE /api/v1/social/follow/:userId` - å–æ¶ˆå…³æ³¨
- `GET /api/v1/social/following/:userId` - è·å–å…³æ³¨åˆ—è¡¨
- `GET /api/v1/social/followers/:userId` - è·å–ç²‰ä¸åˆ—è¡¨

### 2. ç”¨æˆ·åŠ¨æ€æµç³»ç»Ÿ ğŸ“±
- âœ… å…³æ³¨ç”¨æˆ·çš„æ´»åŠ¨åŠ¨æ€
- âœ… ä¸ªäººæ´»åŠ¨æ—¶é—´çº¿
- âœ… å¤šç§åŠ¨æ€ç±»å‹ï¼šæ ‡æ³¨ã€ç‚¹èµã€è¯„è®ºã€å…³æ³¨ã€åˆ†äº«
- âœ… éšç§çº§åˆ«æ§åˆ¶ï¼ˆå…¬å¼€/ä»…å…³æ³¨è€…/ç§æœ‰ï¼‰

**æ ¸å¿ƒç»„ä»¶:**
- `UserFeedModel` - åŠ¨æ€æµæ•°æ®æ¨¡å‹
- `FeedController` - åŠ¨æ€æµæ§åˆ¶å™¨

**APIç«¯ç‚¹:**
- `GET /api/v1/feed` - è·å–ç”¨æˆ·åŠ¨æ€æµ
- `GET /api/v1/users/:userId/activity` - è·å–ç”¨æˆ·æ´»åŠ¨å†å²

### 3. è¯„è®ºå’Œç‚¹èµç³»ç»Ÿ ğŸ’¬â¤ï¸
- âœ… æ ‡æ³¨è¯„è®ºåŠŸèƒ½ï¼ˆæ”¯æŒå›å¤ï¼‰
- âœ… è¯„è®ºç‚¹èµç³»ç»Ÿ
- âœ… æ ‡æ³¨ç‚¹èµå’Œæ”¶è—
- âœ… å®æ—¶é€šçŸ¥æ¨é€

**å¢å¼ºåŠŸèƒ½:**
- è¯„è®ºåµŒå¥—å›å¤
- ç‚¹èµæ•°ç»Ÿè®¡å’Œç¼“å­˜
- è¯„è®ºæ’åºï¼ˆæœ€æ–°/æœ€çƒ­/ç‚¹èµæ•°ï¼‰
- åƒåœ¾è¯„è®ºè¿‡æ»¤

### 4. ç”¨æˆ·ä¸ªäººèµ„æ–™é¡µé¢ ğŸ‘¤
- âœ… å®Œæ•´çš„ç”¨æˆ·èµ„æ–™å±•ç¤º
- âœ… ç¤¾äº¤ç»Ÿè®¡æ•°æ®
- âœ… ç”¨æˆ·æˆå°±ç³»ç»Ÿ
- âœ… éšç§è®¾ç½®æ§åˆ¶

**ç»Ÿè®¡æ•°æ®åŒ…æ‹¬:**
- æ ‡æ³¨æ•°é‡ã€è¯„è®ºæ•°é‡ã€ç‚¹èµæ•°
- å…³æ³¨è€…å’Œå…³æ³¨æ•°é‡
- å£°èª‰åˆ†æ•°å’Œæ´»è·ƒåº¦
- ä¸ªäººæˆå°±å¾½ç« 

**APIç«¯ç‚¹:**
- `GET /api/v1/users/:userId/profile` - è·å–ç”¨æˆ·èµ„æ–™
- `PUT /api/v1/users/:userId/profile` - æ›´æ–°èµ„æ–™
- `GET /api/v1/users/:userId/achievements` - è·å–æˆå°±
- `GET /api/v1/users/:userId/timeline` - æ´»åŠ¨æ—¶é—´çº¿

### 5. ç¤¾äº¤æ¨èç®—æ³• ğŸ¤–
- âœ… æ™ºèƒ½ç”¨æˆ·æ¨è
- âœ… ä¸ªæ€§åŒ–å†…å®¹æ¨è
- âœ… åŸºäºåœ°ç†ä½ç½®çš„æ¨è
- âœ… å…´è¶£æ ‡ç­¾åŒ¹é…

**æ¨èç­–ç•¥:**
- å…±åŒå…³æ³¨æ¨èï¼ˆ40%æƒé‡ï¼‰
- å…´è¶£ç›¸ä¼¼åº¦æ¨èï¼ˆ40%æƒé‡ï¼‰
- åœ°ç†ä½ç½®æ¨èï¼ˆ30%æƒé‡ï¼‰
- æ´»è·ƒç”¨æˆ·æ¨èï¼ˆ30%æƒé‡ï¼‰

**APIç«¯ç‚¹:**
- `GET /api/v1/recommendations/users` - ç”¨æˆ·æ¨è
- `GET /api/v1/recommendations/content` - å†…å®¹æ¨è
- `GET /api/v1/recommendations/users/nearby` - é™„è¿‘ç”¨æˆ·
- `GET /api/v1/recommendations/content/trending` - çƒ­é—¨å†…å®¹

### 6. éšç§è®¾ç½®å’Œå†…å®¹å®¡æ ¸ ğŸ›¡ï¸
- âœ… ç»†ç²’åº¦éšç§æ§åˆ¶
- âœ… å†…å®¹ä¸¾æŠ¥ç³»ç»Ÿ
- âœ… ç®¡ç†å‘˜å®¡æ ¸å·¥å…·
- âœ… è‡ªåŠ¨å†…å®¹è¿‡æ»¤

**éšç§è®¾ç½®:**
- èµ„æ–™å¯è§æ€§ï¼ˆå…¬å¼€/ä»…å…³æ³¨è€…/ç§æœ‰ï¼‰
- æ´»åŠ¨å¯è§æ€§æ§åˆ¶
- ä½ç½®ä¿¡æ¯éšç§è®¾ç½®

**å®¡æ ¸åŠŸèƒ½:**
- ç”¨æˆ·ä¸¾æŠ¥å†…å®¹
- ç®¡ç†å‘˜å®¡æ ¸é˜Ÿåˆ—
- è‡ªåŠ¨åƒåœ¾å†…å®¹æ£€æµ‹
- è¿è§„ç”¨æˆ·è­¦å‘Šç³»ç»Ÿ

**APIç«¯ç‚¹:**
- `POST /api/v1/moderation/reports` - ä¸¾æŠ¥å†…å®¹
- `GET /api/v1/moderation/queue` - å®¡æ ¸é˜Ÿåˆ—ï¼ˆç®¡ç†å‘˜ï¼‰
- `POST /api/v1/moderation/reports/:id/moderate` - å¤„ç†ä¸¾æŠ¥

### 7. å®æ—¶é€šçŸ¥ç³»ç»Ÿ ğŸ””
- âœ… WebSocket å®æ—¶æ¨é€
- âœ… å¤šç±»å‹é€šçŸ¥æ”¯æŒ
- âœ… é€šçŸ¥ä¼˜å…ˆçº§ç®¡ç†
- âœ… é‚®ä»¶é€šçŸ¥é›†æˆ

**é€šçŸ¥ç±»å‹:**
- æ–°å…³æ³¨è€…é€šçŸ¥
- ç‚¹èµå’Œè¯„è®ºé€šçŸ¥
- å›å¤å’ŒæåŠé€šçŸ¥
- ç³»ç»Ÿå…¬å‘Šé€šçŸ¥

### 8. æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜ âš¡
- âœ… Redis ç¼“å­˜ç­–ç•¥
- âœ… æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- âœ… æ‰¹é‡æ“ä½œæ”¯æŒ
- âœ… ç¼“å­˜å¤±æ•ˆç­–ç•¥

**ç¼“å­˜ç­–ç•¥:**
- ç”¨æˆ·ç»Ÿè®¡æ•°æ®ç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰
- åŠ¨æ€æµç¼“å­˜ï¼ˆ10åˆ†é’Ÿï¼‰
- æ¨èå†…å®¹ç¼“å­˜ï¼ˆ30åˆ†é’Ÿï¼‰
- çƒ­é—¨å†…å®¹ç¼“å­˜ï¼ˆ1å°æ—¶ï¼‰

## æŠ€æœ¯æ¶æ„

### æ•°æ®åº“è®¾è®¡

#### æ–°å¢æ•°æ®è¡¨

1. **user_feeds** - ç”¨æˆ·åŠ¨æ€æµ
   ```sql
   - id: string (ä¸»é”®)
   - user_id: string (æ¥æ”¶è€…ID)
   - actor_id: string (æ‰§è¡Œè€…ID)
   - action_type: enum (åŠ¨ä½œç±»å‹)
   - target_type: enum (ç›®æ ‡ç±»å‹)
   - target_id: string (ç›®æ ‡ID)
   - metadata: text (JSONå…ƒæ•°æ®)
   - privacy_level: enum (éšç§çº§åˆ«)
   - created_at: timestamp
   ```

2. **user_privacy_settings** - éšç§è®¾ç½®
   ```sql
   - user_id: string (ä¸»é”®)
   - profile_visibility: enum
   - activity_visibility: enum
   - location_visibility: enum
   - email_notifications: boolean
   - push_notifications: boolean
   - created_at/updated_at: timestamp
   ```

3. **user_interest_tags** - ç”¨æˆ·å…´è¶£æ ‡ç­¾
   ```sql
   - id: string (ä¸»é”®)
   - user_id: string
   - tag_name: string
   - tag_category: string
   - confidence_score: decimal
   - interaction_count: integer
   - last_updated/created_at: timestamp
   ```

4. **content_moderation** - å†…å®¹å®¡æ ¸
   ```sql
   - id: string (ä¸»é”®)
   - content_type: enum
   - content_id: string
   - reported_by: string
   - moderator_id: string
   - reason: enum
   - status: enum
   - moderator_notes: text
   - reported_at/moderated_at: timestamp
   ```

5. **user_activity_stats** - æ´»åŠ¨ç»Ÿè®¡ç¼“å­˜
   ```sql
   - user_id: string (ä¸»é”®)
   - total_annotations: integer
   - total_comments: integer
   - total_likes_given/received: integer
   - followers_count/following_count: integer
   - reputation_score: decimal
   - last_calculated/updated_at: timestamp
   ```

### æ ¸å¿ƒç»„ä»¶

#### æ¨¡å‹å±‚ (Models)
- `UserFeedModel` - åŠ¨æ€æµç®¡ç†
- `SocialRecommendationModel` - æ¨èç®—æ³•
- æ‰©å±•çš„ `UserModel` - å¢å¼ºç”¨æˆ·ç»Ÿè®¡

#### æ§åˆ¶å™¨å±‚ (Controllers)
- `FeedController` - åŠ¨æ€æµAPI
- `RecommendationController` - æ¨èAPI
- `ProfileController` - ç”¨æˆ·èµ„æ–™API
- `ModerationController` - å†…å®¹å®¡æ ¸API

#### æœåŠ¡å±‚ (Services)
- `SocialCacheService` - ç¼“å­˜ç®¡ç†
- `WebSocketManager` - å®æ—¶é€šçŸ¥
- `EmailService` - é‚®ä»¶é€šçŸ¥

### APIè·¯ç”±ç»“æ„

```
/api/v1/
â”œâ”€â”€ feed                    # åŠ¨æ€æµ
â”œâ”€â”€ recommendations/        # æ¨èç³»ç»Ÿ
â”‚   â”œâ”€â”€ users              # ç”¨æˆ·æ¨è
â”‚   â”œâ”€â”€ content            # å†…å®¹æ¨è
â”‚   â””â”€â”€ users/nearby       # é™„è¿‘ç”¨æˆ·
â”œâ”€â”€ users/:id/
â”‚   â”œâ”€â”€ profile            # ç”¨æˆ·èµ„æ–™
â”‚   â”œâ”€â”€ annotations        # ç”¨æˆ·æ ‡æ³¨
â”‚   â”œâ”€â”€ achievements       # ç”¨æˆ·æˆå°±
â”‚   â””â”€â”€ timeline           # æ´»åŠ¨æ—¶é—´çº¿
â”œâ”€â”€ social/
â”‚   â”œâ”€â”€ follow/:userId     # å…³æ³¨æ“ä½œ
â”‚   â”œâ”€â”€ following/:userId  # å…³æ³¨åˆ—è¡¨
â”‚   â”œâ”€â”€ followers/:userId  # ç²‰ä¸åˆ—è¡¨
â”‚   â””â”€â”€ notifications      # é€šçŸ¥ç®¡ç†
â””â”€â”€ moderation/            # å†…å®¹å®¡æ ¸
    â”œâ”€â”€ reports            # ä¸¾æŠ¥ç®¡ç†
    â””â”€â”€ queue              # å®¡æ ¸é˜Ÿåˆ—
```

## éƒ¨ç½²å’Œè¿è¡Œ

### 1. æ•°æ®åº“è¿ç§»

```bash
# è¿è¡Œæ–°çš„ç¤¾äº¤åŠŸèƒ½è¿ç§»
npm run migrate

# åº”ç”¨çš„è¿ç§»æ–‡ä»¶
migrations/015_add_enhanced_social_features.js
```

### 2. ç¯å¢ƒå˜é‡é…ç½®

ç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå˜é‡å·²æ­£ç¡®è®¾ç½®ï¼š
```env
# Redis ç¼“å­˜
REDIS_URL=redis://localhost:6379
REDIS_PASSWORD=

# WebSocket é…ç½®
WEBSOCKET_PORT=3001
WEBSOCKET_CORS_ORIGIN=http://localhost:3000

# é€šçŸ¥é…ç½®
EMAIL_SERVICE_ENABLED=true
PUSH_NOTIFICATIONS_ENABLED=true

# æ¨èç®—æ³•é…ç½®
RECOMMENDATION_UPDATE_INTERVAL=3600000  # 1å°æ—¶
TRENDING_CONTENT_TTL=7200000           # 2å°æ—¶
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨åç«¯æœåŠ¡
npm run dev

# å¯åŠ¨WorkersæœåŠ¡
cd workers && npm run dev

# å¯åŠ¨å‰ç«¯
cd frontend && npm run dev
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ä¼˜åŒ–
- ä¸ºé«˜é¢‘æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± 
- å®æ–½è¯»å†™åˆ†ç¦»ï¼ˆå¦‚éœ€è¦ï¼‰

### 2. ç¼“å­˜ç­–ç•¥
- çƒ­ç‚¹æ•°æ®é¢„åŠ è½½
- ç¼“å­˜ç©¿é€ä¿æŠ¤
- åˆ†å¸ƒå¼ç¼“å­˜ä¸€è‡´æ€§

### 3. æŸ¥è¯¢ä¼˜åŒ–
- ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢
- é¿å…N+1æŸ¥è¯¢é—®é¢˜
- æ‰¹é‡æ“ä½œä¼˜åŒ–

### 4. å®æ—¶é€šçŸ¥ä¼˜åŒ–
- WebSocketè¿æ¥æ± ç®¡ç†
- æ¶ˆæ¯å»é‡å’Œåˆå¹¶
- ç¦»çº¿æ¶ˆæ¯å­˜å‚¨

## ç›‘æ§å’Œç»´æŠ¤

### 1. å…³é”®æŒ‡æ ‡ç›‘æ§
- ç”¨æˆ·æ´»è·ƒåº¦ç»Ÿè®¡
- ç¤¾äº¤äº’åŠ¨é¢‘ç‡
- æ¨èç®—æ³•æ•ˆæœ
- ç¼“å­˜å‘½ä¸­ç‡
- APIå“åº”æ—¶é—´

### 2. æ—¥å¿—è®°å½•
- ç”¨æˆ·è¡Œä¸ºæ—¥å¿—
- é”™è¯¯å’Œå¼‚å¸¸æ—¥å¿—
- æ€§èƒ½æŒ‡æ ‡æ—¥å¿—
- å®‰å…¨äº‹ä»¶æ—¥å¿—

### 3. å®šæœŸç»´æŠ¤ä»»åŠ¡
- æ¸…ç†è¿‡æœŸåŠ¨æ€æ•°æ®
- é‡æ–°è®¡ç®—æ¨èæƒé‡
- ç¼“å­˜é¢„çƒ­ä»»åŠ¡
- æ•°æ®åº“ç»Ÿè®¡æ›´æ–°

## å®‰å…¨è€ƒè™‘

### 1. æ•°æ®ä¿æŠ¤
- ç”¨æˆ·éšç§æ•°æ®åŠ å¯†
- æ•æ„Ÿä¿¡æ¯è„±æ•
- è®¿é—®æƒé™æ§åˆ¶

### 2. é˜²æ»¥ç”¨æœºåˆ¶
- é¢‘ç‡é™åˆ¶å’ŒèŠ‚æµ
- åƒåœ¾å†…å®¹æ£€æµ‹
- æ¶æ„ç”¨æˆ·è¯†åˆ«

### 3. å†…å®¹å®¡æ ¸
- è‡ªåŠ¨è¿è§„æ£€æµ‹
- äººå·¥å®¡æ ¸æµç¨‹
- ç”¨æˆ·ä¸¾æŠ¥å¤„ç†

## æœªæ¥æ‰©å±•

### 1. æ¨èç®—æ³•æ”¹è¿›
- æœºå™¨å­¦ä¹ æ¨¡å‹é›†æˆ
- æ·±åº¦å­¦ä¹ æ¨èå¼•æ“
- A/Bæµ‹è¯•æ¡†æ¶

### 2. ç¤¾äº¤åŠŸèƒ½å¢å¼º
- ç¾¤ç»„å’Œç¤¾åŒºåŠŸèƒ½
- ç›´æ’­å’Œå®æ—¶äº’åŠ¨
- æ¸¸æˆåŒ–å…ƒç´ 

### 3. ç§»åŠ¨ç«¯ä¼˜åŒ–
- æ¨é€é€šçŸ¥ä¼˜åŒ–
- ç¦»çº¿åŠŸèƒ½æ”¯æŒ
- æ€§èƒ½ä¼˜åŒ–

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰æŠ€æœ¯é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- é¡¹ç›®æ—¥å¿—æ–‡ä»¶
- æ•°æ®åº“ç›‘æ§é¢æ¿
- Redisç›‘æ§å·¥å…·
- APIæ–‡æ¡£å’Œæµ‹è¯•

## æ›´æ–°è®°å½•

- **v1.0** - åŸºç¡€ç¤¾äº¤åŠŸèƒ½å®ç°
- **v1.1** - æ¨èç®—æ³•ä¼˜åŒ–
- **v1.2** - æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜ç­–ç•¥
- **v1.3** - å†…å®¹å®¡æ ¸å’Œéšç§è®¾ç½®

---

*æœ¬æ–‡æ¡£æœ€åæ›´æ–°ï¼š2025-01-09*