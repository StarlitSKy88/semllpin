<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmellPin - 全球臭味标记地图</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" defer></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#D946EF', // 主色调：明亮紫色（代表独特性和关注）
                        secondary: '#3B82F6', // 辅助色：蓝色
                        accent: '#FDE68A', // 强调色：黄色
                        dark: '#1E293B',
                        light: '#F8FAFC',
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .map-height {
                height: calc(100vh - 64px);
            }
            .sidebar-height {
                height: calc(100vh - 64px);
            }
            .pin-bounce {
                animation: bounce 2s infinite;
            }
            .fade-in {
                animation: fadeIn 0.5s ease-in-out;
            }
            .slide-up {
                animation: slideUp 0.4s ease-out;
            }
            .pulse-ring {
                animation: pulseRing 2s infinite;
            }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulseRing {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* 图钉样式 */
        .custom-pin {
            position: relative;
            transform-origin: bottom center;
        }
        
        .pin-icon {
            color: #D946EF;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        .pin-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #D946EF;
        }
    </style>
</head>
<body class="bg-light text-dark font-inter overflow-hidden">
    <!-- 导航栏 -->
    <header class="bg-white shadow-md z-50 relative transition-all duration-300">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <!-- 品牌标识 -->
                <div class="flex items-center">
                    <i class="fa fa-map-pin text-primary text-2xl mr-2 pin-bounce"></i>
                    <span class="text-xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">SmellPin</span>
                </div>
                
                <!-- 导航链接 - 桌面版 -->
                <nav class="hidden md:flex space-x-8">
                    <a href="#" class="text-dark hover:text-primary transition-colors font-medium flex items-center">
                        <i class="fa fa-globe mr-1"></i> 探索地图
                    </a>
                    <a href="#" class="text-dark hover:text-primary transition-colors font-medium flex items-center">
                        <i class="fa fa-trophy mr-1"></i> 臭味排行
                    </a>
                    <a href="#" class="text-dark hover:text-primary transition-colors font-medium flex items-center">
                        <i class="fa fa-info-circle mr-1"></i> 关于
                    </a>
                </nav>
                
                <!-- 用户操作按钮 -->
                <div class="flex items-center space-x-4">
                    <div class="hidden md:flex items-center bg-gray-100 rounded-full px-3 py-1">
                        <i class="fa fa-credit-card text-secondary mr-1"></i>
                        <span class="text-sm font-medium" id="userBalance">$25.00</span>
                    </div>
                    <button id="loginBtn" class="hidden md:flex items-center px-4 py-2 rounded-full text-dark hover:bg-gray-100 transition-colors">
                        <i class="fa fa-user-circle mr-2"></i> 登录
                    </button>
                    <button id="mobileMenuBtn" class="md:hidden text-dark text-xl">
                        <i class="fa fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 移动端菜单 -->
        <div id="mobileMenu" class="hidden h-0 overflow-hidden bg-white shadow-lg absolute w-full left-0 top-16 transition-all duration-300">
            <div class="px-4 py-3 space-y-3">
                <a href="#" class="block py-2 text-dark hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-globe mr-2 w-5 text-center"></i> 探索地图
                </a>
                <a href="#" class="block py-2 text-dark hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-trophy mr-2 w-5 text-center"></i> 臭味排行
                </a>
                <a href="#" class="block py-2 text-dark hover:text-primary transition-colors flex items-center">
                    <i class="fa fa-info-circle mr-2 w-5 text-center"></i> 关于
                </a>
                <div class="flex items-center bg-gray-100 rounded-full px-3 py-1.5">
                    <i class="fa fa-credit-card text-secondary mr-1"></i>
                    <span class="text-sm font-medium" id="mobileUserBalance">$25.00</span>
                </div>
                <div class="pt-2 border-t border-gray-100">
                    <button class="w-full flex items-center justify-center px-4 py-2 rounded-full text-dark border border-gray-300 hover:bg-gray-100 transition-colors">
                        <i class="fa fa-user-circle mr-2"></i> 登录/注册
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex flex-col md:flex-row">
        <!-- 侧边栏 -->
        <aside id="sidebar" class="bg-white w-full md:w-80 shadow-lg sidebar-height overflow-y-auto transition-all duration-300 z-40 transform translate-x-0 md:translate-x-0">
            <div class="p-4">
                <div class="mb-6">
                    <h2 class="text-xl font-bold mb-3 flex items-center">
                        <i class="fa fa-search text-primary mr-2"></i> 臭味探索
                    </h2>
                    <div class="relative">
                        <input type="text" placeholder="搜索地点..." 
                            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary/50">
                        <i class="fa fa-search absolute right-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                
                <!-- 臭味等级筛选 -->
                <div class="mb-6 bg-gradient-to-br from-purple-50 to-blue-50 p-4 rounded-xl">
                    <h3 class="font-semibold mb-3 text-dark">臭味等级筛选</h3>
                    <div class="space-y-2">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-primary rounded" checked>
                            <span class="ml-2 text-sm flex items-center">
                                <span class="w-3 h-3 rounded-full bg-green-500 mr-1"></span>
                                轻微 (1-3)
                            </span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-primary rounded" checked>
                            <span class="ml-2 text-sm flex items-center">
                                <span class="w-3 h-3 rounded-full bg-yellow-500 mr-1"></span>
                                中等 (4-6)
                            </span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-primary rounded" checked>
                            <span class="ml-2 text-sm flex items-center">
                                <span class="w-3 h-3 rounded-full bg-orange-500 mr-1"></span>
                                强烈 (7-8)
                            </span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-primary rounded" checked>
                            <span class="ml-2 text-sm flex items-center">
                                <span class="w-3 h-3 rounded-full bg-red-500 mr-1"></span>
                                极其强烈 (9-10)
                            </span>
                        </label>
                    </div>
                </div>
                
                <!-- 快速标注按钮 -->
                <button id="addMarkerBtn" class="w-full py-3 bg-primary text-white rounded-xl font-medium hover:bg-primary/90 transition-all shadow-lg hover:shadow-primary/30 flex items-center justify-center group">
                    <i class="fa fa-map-pin mr-2 text-lg group-hover:scale-110 transition-transform"></i>
                    添加臭味标记
                    <span class="ml-2 bg-white/20 px-2 py-0.5 rounded text-sm">仅 $1</span>
                </button>
                
                <!-- 标注说明 -->
                <div class="mt-4 text-xs text-gray-500 text-center">
                    每次标注收费 $1，无上限。您的标注将影响该地点的臭味等级
                </div>
            </div>
            
            <!-- 热门臭味地点 -->
            <div class="p-4 border-t border-gray-100">
                <h3 class="font-semibold mb-3 flex items-center">
                    <i class="fa fa-fire text-orange-500 mr-2"></i> 热门臭味地点
                </h3>
                <div class="space-y-4">
                    <!-- 地点卡片 - 极其强烈 -->
                    <div class="flex items-start p-3 rounded-xl hover:bg-gray-50 cursor-pointer transition-colors border border-gray-100 hover:border-primary/30 group">
                        <div class="w-12 h-12 rounded-full bg-red-50 flex items-center justify-center flex-shrink-0 group-hover:scale-105 transition-transform">
                            <i class="fa fa-map-pin text-red-500 text-xl"></i>
                        </div>
                        <div class="ml-3 flex-1">
                            <h4 class="font-medium group-hover:text-primary transition-colors">城南垃圾填埋场</h4>
                            <div class="flex items-center mt-1">
                                <div class="flex">
                                    <i class="fa fa-star text-red-500 text-xs"></i>
                                    <i class="fa fa-star text-red-500 text-xs"></i>
                                    <i class="fa fa-star text-red-500 text-xs"></i>
                                    <i class="fa fa-star text-red-500 text-xs"></i>
                                    <i class="fa fa-star text-red-500 text-xs"></i>
                                </div>
                                <span class="text-xs text-gray-500 ml-1">等级: 9.2</span>
                            </div>
                            <div class="mt-1 flex items-center text-xs text-gray-500">
                                <i class="fa fa-users mr-1"></i>
                                <span>128人标注</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 地点卡片 - 强烈 -->
                    <div class="flex items-start p-3 rounded-xl hover:bg-gray-50 cursor-pointer transition-colors border border-gray-100 hover:border-primary/30 group">
                        <div class="w-12 h-12 rounded-full bg-orange-50 flex items-center justify-center flex-shrink-0 group-hover:scale-105 transition-transform">
                            <i class="fa fa-map-pin text-orange-500 text-xl"></i>
                        </div>
                        <div class="ml-3 flex-1">
                            <h4 class="font-medium group-hover:text-primary transition-colors">纽约污水处理厂</h4>
                            <div class="flex items-center mt-1">
                                <div class="flex">
                                    <i class="fa fa-star text-orange-500 text-xs"></i>
                                    <i class="fa fa-star text-orange-500 text-xs"></i>
                                    <i class="fa fa-star text-orange-500 text-xs"></i>
                                    <i class="fa fa-star text-orange-500 text-xs"></i>
                                    <i class="fa fa-star-half-o text-orange-500 text-xs"></i>
                                </div>
                                <span class="text-xs text-gray-500 ml-1">等级: 7.5</span>
                            </div>
                            <div class="mt-1 flex items-center text-xs text-gray-500">
                                <i class="fa fa-users mr-1"></i>
                                <span>86人标注</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 地点卡片 - 中等 -->
                    <div class="flex items-start p-3 rounded-xl hover:bg-gray-50 cursor-pointer transition-colors border border-gray-100 hover:border-primary/30 group">
                        <div class="w-12 h-12 rounded-full bg-yellow-50 flex items-center justify-center flex-shrink-0 group-hover:scale-105 transition-transform">
                            <i class="fa fa-map-pin text-yellow-500 text-xl"></i>
                        </div>
                        <div class="ml-3 flex-1">
                            <h4 class="font-medium group-hover:text-primary transition-colors">伦敦工业区边缘</h4>
                            <div class="flex items-center mt-1">
                                <div class="flex">
                                    <i class="fa fa-star text-yellow-500 text-xs"></i>
                                    <i class="fa fa-star text-yellow-500 text-xs"></i>
                                    <i class="fa fa-star text-yellow-500 text-xs"></i>
                                    <i class="fa fa-star-o text-yellow-500 text-xs"></i>
                                    <i class="fa fa-star-o text-yellow-500 text-xs"></i>
                                </div>
                                <span class="text-xs text-gray-500 ml-1">等级: 5.3</span>
                            </div>
                            <div class="mt-1 flex items-center text-xs text-gray-500">
                                <i class="fa fa-users mr-1"></i>
                                <span>42人标注</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="w-full mt-4 py-2 text-secondary hover:text-secondary/80 transition-colors text-sm font-medium flex items-center justify-center">
                    查看更多 <i class="fa fa-chevron-right ml-1 text-xs"></i>
                </button>
            </div>
            
            <!-- 标注统计 -->
            <div class="p-4 border-t border-gray-100 bg-gradient-to-br from-blue-50 to-indigo-50">
                <h3 class="font-semibold mb-3 flex items-center">
                    <i class="fa fa-bar-chart text-secondary mr-2"></i> 全球标注统计
                </h3>
                <div class="space-y-3">
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span>总标注数</span>
                            <span class="font-medium">12,587</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-secondary h-2 rounded-full" style="width: 85%"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span>活跃用户</span>
                            <span class="font-medium">3,842</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-primary h-2 rounded-full" style="width: 62%"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span>覆盖国家</span>
                            <span class="font-medium">87</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-green-500 h-2 rounded-full" style="width: 45%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- 地图区域 -->
        <div class="flex-1 relative">
            <div id="map" class="w-full map-height"></div>
            
            <!-- 地图控制按钮 -->
            <div class="absolute top-4 right-4 z-30 flex flex-col space-y-3">
                <button id="zoomIn" class="w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center hover:bg-gray-50 transition-colors">
                    <i class="fa fa-plus"></i>
                </button>
                <button id="zoomOut" class="w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center hover:bg-gray-50 transition-colors">
                    <i class="fa fa-minus"></i>
                </button>
                <button id="centerMap" class="w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center hover:bg-gray-50 transition-colors">
                    <i class="fa fa-location-arrow"></i>
                </button>
                <button id="toggleLayers" class="w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center hover:bg-gray-50 transition-colors">
                    <i class="fa fa-layer-group"></i>
                </button>
            </div>
            
            <!-- 移动端侧边栏按钮 -->
            <button id="toggleSidebar" class="md:hidden absolute top-4 left-4 z-30 w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center hover:bg-gray-50 transition-colors">
                <i class="fa fa-bars"></i>
            </button>
            
            <!-- 快速添加标记浮动按钮 -->
            <button id="quickAddMarkerBtn" class="fixed bottom-6 right-6 md:hidden w-14 h-14 bg-primary text-white rounded-full shadow-lg flex items-center justify-center hover:bg-primary/90 transition-all hover:scale-105">
                <i class="fa fa-map-pin text-xl"></i>
            </button>
        </div>
    </main>
    
    <!-- 添加臭味标记弹窗 -->
    <div id="addMarkerModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden slide-up">
            <div class="p-5 border-b border-gray-100">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center">
                        <i class="fa fa-map-pin text-primary mr-2"></i> 添加臭味标记
                    </h3>
                    <button id="closeMarkerModal" class="text-gray-400 hover:text-gray-600 transition-colors p-1">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <div class="mt-2 text-sm text-gray-500">
                    标注费用: <span class="text-primary font-medium">$1.00</span>
                </div>
            </div>
            
            <div class="p-5">
                <form id="markerForm">
                    <!-- 臭味等级选择器 -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-3">选择臭味等级 (1-10)</label>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">轻微</span>
                            <div class="flex-1 mx-4">
                                <input type="range" min="1" max="10" value="7" class="w-full accent-primary" id="smellIntensity">
                            </div>
                            <span class="text-sm text-gray-500">强烈</span>
                        </div>
                        <div class="mt-3 flex justify-center">
                            <span id="intensityValue" class="text-3xl font-bold text-primary">7</span>
                        </div>
                        <div class="flex justify-between mt-1 px-2">
                            <span class="text-xs text-gray-500">几乎察觉不到</span>
                            <span class="text-xs text-gray-500">难以忍受</span>
                        </div>
                    </div>
                    
                    <div class="mb-5">
                        <label class="block text-sm font-medium mb-2">臭味描述 (可选)</label>
                        <textarea rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="描述一下这里的臭味...例如：像腐烂的垃圾味，在夏季特别明显..."></textarea>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">上传照片 (可选)</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:bg-gray-50 transition-colors cursor-pointer group">
                            <i class="fa fa-camera text-gray-400 text-2xl mb-2 group-hover:text-primary transition-colors"></i>
                            <p class="text-sm text-gray-500">点击或拖拽照片到此处</p>
                            <input type="file" class="hidden" accept="image/*" id="photoUpload">
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg mb-5">
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-medium">余额</span>
                            <span class="font-bold" id="balanceInModal">$25.00</span>
                        </div>
                        <div class="flex justify-between items-center mt-2 text-sm">
                            <span class="text-gray-500">本次扣除</span>
                            <span class="text-primary font-medium">-$1.00</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full py-3 bg-primary text-white rounded-xl font-medium hover:bg-primary/90 transition-all shadow-lg hover:shadow-primary/30 flex items-center justify-center">
                        <i class="fa fa-check mr-2"></i> 确认标注 ($1.00)
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- 臭味详情弹窗 -->
    <div id="smellDetailModal" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-xl z-40 hidden slide-up max-h-[70vh] overflow-y-auto">
        <div class="p-5 border-b border-gray-100">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-bold">城南垃圾填埋场</h3>
                <button id="closeDetailModal" class="text-gray-400 hover:text-gray-600 transition-colors p-1">
                    <i class="fa fa-times"></i>
                </button>
            </div>
        </div>
        
        <div class="p-5">
            <!-- 臭味等级和评分 -->
            <div class="flex items-center mb-4">
                <div class="px-3 py-1 bg-red-100 text-red-600 text-sm rounded-full font-medium">
                    极其强烈
                </div>
                <div class="ml-3 flex items-center">
                    <div class="flex">
                        <i class="fa fa-star text-red-500"></i>
                        <i class="fa fa-star text-red-500"></i>
                        <i class="fa fa-star text-red-500"></i>
                        <i class="fa fa-star text-red-500"></i>
                        <i class="fa fa-star text-red-500"></i>
                    </div>
                    <span class="ml-2 text-xl font-bold text-red-500">9.2</span>
                    <span class="text-sm text-gray-500 ml-1">(128人标注)</span>
                </div>
            </div>
            
            <!-- 臭味描述 -->
            <div class="mb-5">
                <h4 class="font-medium mb-2 text-gray-700">臭味描述</h4>
                <p class="text-gray-600">该垃圾填埋场散发着强烈的腐败气味，特别是在夏季高温时更为明显。周围1公里范围内都能闻到明显的臭味，附近居民反映严重影响生活质量。主要成分为腐烂有机物产生的混合气体。</p>
                
                <div class="mt-3 grid grid-cols-2 gap-2">
                    <div class="bg-gray-50 p-2 rounded-lg flex items-center text-sm">
                        <i class="fa fa-clock-o text-gray-400 mr-2"></i>
                        <span>全天有臭味，傍晚加重</span>
                    </div>
                    <div class="bg-gray-50 p-2 rounded-lg flex items-center text-sm">
                        <i class="fa fa-thermometer-full text-gray-400 mr-2"></i>
                        <span>温度越高，臭味越浓</span>
                    </div>
                </div>
            </div>
            
            <!-- 照片展示 -->
            <div class="mb-5">
                <h4 class="font-medium mb-2 text-gray-700">现场照片</h4>
                <div class="grid grid-cols-3 gap-2">
                    <img src="https://picsum.photos/seed/smell1/300/200" alt="垃圾填埋场照片" class="rounded-lg w-full h-24 object-cover hover:opacity-90 transition-opacity cursor-pointer">
                    <img src="https://picsum.photos/seed/smell2/300/200" alt="垃圾填埋场远景" class="rounded-lg w-full h-24 object-cover hover:opacity-90 transition-opacity cursor-pointer">
                    <img src="https://picsum.photos/seed/smell3/300/200" alt="垃圾填埋场周边环境" class="rounded-lg w-full h-24 object-cover hover:opacity-90 transition-opacity cursor-pointer">
                </div>
            </div>
            
            <!-- 臭味趋势图表 -->
            <div class="mb-5">
                <h4 class="font-medium mb-2 text-gray-700">臭味等级趋势 (过去6个月)</h4>
                <div class="h-40">
                    <canvas id="smellTrendChart"></canvas>
                </div>
            </div>
            
            <!-- 用户评论预览 -->
            <div class="mb-5">
                <div class="flex justify-between items-center mb-2">
                    <h4 class="font-medium text-gray-700">用户评论</h4>
                    <a href="#" class="text-sm text-secondary hover:underline">查看全部24条</a>
                </div>
                
                <div class="space-y-3">
                    <div class="p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center">
                            <img src="https://picsum.photos/seed/user1/40/40" alt="用户头像" class="w-6 h-6 rounded-full">
                            <span class="ml-2 text-sm font-medium">张明</span>
                            <span class="ml-auto text-xs text-gray-500">3天前</span>
                        </div>
                        <p class="mt-2 text-sm text-gray-600">上周路过这里，味道真的难以忍受，必须戴口罩才行。</p>
                    </div>
                    
                    <div class="p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center">
                            <img src="https://picsum.photos/seed/user2/40/40" alt="用户头像" class="w-6 h-6 rounded-full">
                            <span class="ml-2 text-sm font-medium">李华</span>
                            <span class="ml-auto text-xs text-gray-500">1周前</span>
                        </div>
                        <p class="mt-2 text-sm text-gray-600">下雨天后稍微好一点，但依然能闻到明显的异味。</p>
                    </div>
                </div>
            </div>
            
            <!-- 操作按钮 -->
            <div class="flex space-x-3">
                <button class="flex-1 py-2 border border-gray-300 rounded-lg text-dark hover:bg-gray-50 transition-colors">
                    <i class="fa fa-comment mr-1"></i> 写评论
                </button>
                <button class="flex-1 py-2 border border-gray-300 rounded-lg text-dark hover:bg-gray-50 transition-colors">
                    <i class="fa fa-share-alt mr-1"></i> 分享
                </button>
                <button class="flex-1 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                    <i class="fa fa-plus mr-1"></i> 我也标注
                </button>
            </div>
        </div>
    </div>
    
    <!-- 登录弹窗 -->
    <div id="loginModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 slide-up">
            <div class="p-5 border-b border-gray-100">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold">登录您的账户</h3>
                    <button class="closeModal text-gray-400 hover:text-gray-600 transition-colors p-1">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-5">
                <form>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">电子邮箱</label>
                        <input type="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="your@email.com">
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">密码</label>
                        <input type="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="••••••••">
                        <div class="flex justify-end mt-2">
                            <a href="#" class="text-sm text-secondary hover:underline">忘记密码?</a>
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full py-3 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors shadow hover:shadow-md mb-4">
                        登录
                    </button>
                    
                    <div class="text-center text-sm text-gray-500">
                        还没有账号? <a href="#" class="text-primary hover:underline">立即注册</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 移动端菜单切换
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenu = document.getElementById('mobileMenu');
            
            mobileMenuBtn.addEventListener('click', function() {
                if (mobileMenu.classList.contains('h-0')) {
                    mobileMenu.classList.remove('h-0');
                    mobileMenu.classList.add('h-auto');
                } else {
                    mobileMenu.classList.add('h-0');
                    mobileMenu.classList.remove('h-auto');
                }
            });
            
            // 侧边栏切换（移动端）
            const toggleSidebarBtn = document.getElementById('toggleSidebar');
            const sidebar = document.getElementById('sidebar');
            
            toggleSidebarBtn.addEventListener('click', function() {
                if (sidebar.classList.contains('-translate-x-full')) {
                    sidebar.classList.remove('-translate-x-full');
                    sidebar.classList.add('translate-x-0');
                } else {
                    sidebar.classList.add('-translate-x-full');
                    sidebar.classList.remove('translate-x-0');
                }
            });
            
            // 臭味强度滑块交互
            const intensitySlider = document.getElementById('smellIntensity');
            const intensityValue = document.getElementById('intensityValue');
            
            intensitySlider.addEventListener('input', function() {
                intensityValue.textContent = this.value;
                
                // 根据数值改变颜色
                let color;
                if (this.value <= 3) color = 'text-green-500';
                else if (this.value <= 6) color = 'text-yellow-500';
                else if (this.value <= 8) color = 'text-orange-500';
                else color = 'text-red-500';
                
                intensityValue.className = `text-3xl font-bold ${color}`;
            });
            
            // 模态框控制
            const addMarkerBtn = document.getElementById('addMarkerBtn');
            const quickAddMarkerBtn = document.getElementById('quickAddMarkerBtn');
            const addMarkerModal = document.getElementById('addMarkerModal');
            const closeMarkerModal = document.getElementById('closeMarkerModal');
            const smellDetailModal = document.getElementById('smellDetailModal');
            const closeDetailModal = document.getElementById('closeDetailModal');
            const loginBtn = document.getElementById('loginBtn');
            const loginModal = document.getElementById('loginModal');
            const closeModals = document.querySelectorAll('.closeModal');
            
            // 打开添加标记模态框
            function openMarkerModal() {
                addMarkerModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
            
            addMarkerBtn.addEventListener('click', openMarkerModal);
            quickAddMarkerBtn.addEventListener('click', openMarkerModal);
            
            // 关闭添加标记模态框
            closeMarkerModal.addEventListener('click', function() {
                addMarkerModal.style.display = 'none';
                document.body.style.overflow = '';
            });
            
            // 关闭详情模态框
            closeDetailModal.addEventListener('click', function() {
                smellDetailModal.style.display = 'none';
            });
            
            // 打开登录模态框
            loginBtn.addEventListener('click', function() {
                loginModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            });
            
            // 关闭所有模态框
            closeModals.forEach(btn => {
                btn.addEventListener('click', function() {
                    loginModal.style.display = 'none';
                    document.body.style.overflow = '';
                });
            });
            
            // 点击模态框外部关闭
            window.addEventListener('click', function(event) {
                if (event.target === addMarkerModal) {
                    addMarkerModal.style.display = 'none';
                    document.body.style.overflow = '';
                }
                if (event.target === loginModal) {
                    loginModal.style.display = 'none';
                    document.body.style.overflow = '';
                }
            });
            
            // 照片上传交互
            const photoUploadArea = document.querySelector('.border-dashed');
            const photoUploadInput = document.getElementById('photoUpload');
            
            photoUploadArea.addEventListener('click', function() {
                photoUploadInput.click();
            });
            
            photoUploadInput.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    // 这里可以添加预览功能
                    alert(`已选择文件: ${this.files[0].name}`);
                }
            });
            
            // 表单提交处理
            const markerForm = document.getElementById('markerForm');
            markerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 模拟表单提交
                addMarkerModal.style.display = 'none';
                document.body.style.overflow = '';
                
                // 更新余额
                const balanceEl = document.getElementById('userBalance');
                const mobileBalanceEl = document.getElementById('mobileUserBalance');
                const balanceInModalEl = document.getElementById('balanceInModal');
                
                const currentBalance = parseFloat(balanceEl.textContent.replace('$', ''));
                const newBalance = currentBalance - 1;
                
                balanceEl.textContent = `$${newBalance.toFixed(2)}`;
                mobileBalanceEl.textContent = `$${newBalance.toFixed(2)}`;
                balanceInModalEl.textContent = `$${newBalance.toFixed(2)}`;
                
                // 显示成功提示
                alert('臭味标记已成功添加！感谢您的贡献。');
                
                // 在实际应用中，这里会将数据发送到服务器并在地图上添加新标记
            });
            
            // 初始化臭味趋势图表
            const ctx = document.getElementById('smellTrendChart').getContext('2d');
            const smellTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                    datasets: [{
                        label: '臭味等级',
                        data: [7.2, 7.5, 8.1, 8.5, 9.0, 9.2],
                        borderColor: '#D946EF',
                        backgroundColor: 'rgba(217, 70, 239, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#D946EF',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // 模拟地图上的标记点击事件，打开详情弹窗
            setTimeout(() => {
                document.getElementById('map').addEventListener('click', function(e) {
                    // 忽略地图控件的点击
                    if (!e.target.closest('#map > div > div:nth-child(1)')) {
                        smellDetailModal.style.display = 'block';
                    }
                });
            }, 1000);
        });
        
        // 初始化Google地图
        function initMap() {
            // 以全球为中心初始化地图
            const map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 20, lng: 0 }, // 大致全球中心
                zoom: 2,
                mapTypeId: 'roadmap',
                disableDefaultUI: true,
                zoomControl: false,
                styles: [
                    {
                        "featureType": "administrative",
                        "elementType": "labels.text.fill",
                        "stylers": [{"color": "#444444"}]
                    },
                    {
                        "featureType": "landscape",
                        "elementType": "all",
                        "stylers": [{"color": "#f2f2f2"}]
                    },
                    {
                        "featureType": "poi",
                        "elementType": "all",
                        "stylers": [{"visibility": "off"}]
                    },
                    {
                        "featureType": "road",
                        "elementType": "all",
                        "stylers": [{"saturation": -100},{"lightness": 45}]
                    },
                    {
                        "featureType": "road.highway",
                        "elementType": "all",
                        "stylers": [{"visibility": "simplified"}]
                    },
                    {
                        "featureType": "road.arterial",
                        "elementType": "labels.icon",
                        "stylers": [{"visibility": "off"}]
                    },
                    {
                        "featureType": "transit",
                        "elementType": "all",
                        "stylers": [{"visibility": "off"}]
                    },
                    {
                        "featureType": "water",
                        "elementType": "all",
                        "stylers": [{"color": "#e9e9e9"},{"visibility": "on"}]
                    }
                ]
            });
            
            // 模拟臭味标记数据
            const smellLocations = [
                { lat: 39.9042, lng: 116.4074, intensity: 9.2, name: '北京垃圾处理厂', count: 128 },
                { lat: 31.2304, lng: 121.4737, intensity: 8.7, name: '上海工业区', count: 95 },
                { lat: 40.7128, lng: -74.0060, intensity: 7.5, name: '纽约污水处理厂', count: 86 },
                { lat: 51.5074, lng: -0.1278, intensity: 5.3, name: '伦敦工业区边缘', count: 42 },
                { lat: 35.6895, lng: 139.6917, intensity: 6.8, name: '东京制造业区', count: 67 }
            ];
            
            // 创建自定义图钉标记
            smellLocations.forEach(location => {
                // 根据臭味强度确定颜色
                let pinColor;
                if (location.intensity <= 3) pinColor = '#10B981'; // 绿色 - 轻微
                else if (location.intensity <= 6) pinColor = '#F59E0B'; // 黄色 - 中等
                else if (location.intensity <= 8) pinColor = '#F97316'; // 橙色 - 强烈
                else pinColor = '#EF4444'; // 红色 - 极其强烈
                
                // 创建图钉图标
                const pinSvg = `
                    <div class="custom-pin">
                        <div class="pin-ring pulse-ring" style="border-color: ${pinColor}"></div>
                        <i class="fa fa-map-pin pin-icon" style="color: ${pinColor}; font-size: 30px;"></i>
                    </div>
                `;
                
                const pinIcon = {
                    url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="40" viewBox="0 0 30 40">
                            <path fill="${pinColor}" d="M15,30c5.5,0,10-4.5,10-10c0-5.5-4.5-10-10-10S5,14.5,5,20C5,25.5,9.5,30,15,30z"/>
                            <path fill="${pinColor}" d="M15,3c3.9,0,7.2,2.3,8.8,5.6l6.6,13.2c0.6,1.3-0.4,2.8-1.8,2.8h-2.8c-0.7,0-1.4-0.4-1.7-1.1L15,14.2l-5.1,7.7
                                c-0.3,0.7-1,1.1-1.7,1.1H1.4c-1.3,0-2.4-1.5-1.8-2.8l6.6-13.2C7.8,5.3,11.1,3,15,3z"/>
                        </svg>
                    `),
                    scaledSize: new google.maps.Size(30, 40),
                    anchor: new google.maps.Point(15, 40)
                };
                
                // 创建标记
                const marker = new google.maps.Marker({
                    position: { lat: location.lat, lng: location.lng },
                    map: map,
                    icon: pinIcon,
                    title: location.name,
                    animation: google.maps.Animation.DROP
                });
                
                // 添加标记点击事件
                marker.addListener('click', function() {
                    document.getElementById('smellDetailModal').style.display = 'block';
                });
            });
            
            // 地图缩放控制
            document.getElementById('zoomIn').addEventListener('click', function() {
                map.setZoom(map.getZoom() + 1);
            });
            
            document.getElementById('zoomOut').addEventListener('click', function() {
                map.setZoom(map.getZoom() - 1);
            });
            
            // 定位到用户当前位置
            document.getElementById('centerMap').addEventListener('click', function() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        map.setCenter(userLocation);
                        map.setZoom(12);
                        
                        // 添加用户位置标记
                        new google.maps.Marker({
                            position: userLocation,
                            map: map,
                            icon: {
                                url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                        <circle fill="#3B82F6" cx="12" cy="12" r="8"/>
                                        <circle fill="#FFFFFF" cx="12" cy="12" r="4"/>
                                    </svg>
                                `),
                                scaledSize: new google.maps.Size(24, 24)
                            },
                            title: '你的位置',
                            animation: google.maps.Animation.BOUNCE
                        });
                        
                        // 3秒后停止弹跳动画
                        setTimeout(() => {
                            marker.setAnimation(null);
                        }, 3000);
                    });
                }
            });
        }
    </script>
</body>
</html>
    