# SmellPin Render éƒ¨ç½² Husky é—®é¢˜ä¿®å¤æŒ‡å—

## é—®é¢˜æè¿°

åœ¨ Render å¹³å°éƒ¨ç½² SmellPin é¡¹ç›®æ—¶é‡åˆ°æ„å»ºå¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š

```
sh: 1: husky: not found
npm error code 127
npm error command failed
npm error command sh -c husky install
==> Build failed ğŸ˜
==> Exited with status 127 while building your code.
```

## é—®é¢˜åŸå› åˆ†æ

### æ ¹æœ¬åŸå› 

* **Husky ä¾èµ–é—®é¢˜**ï¼š`package.json` ä¸­çš„ `prepare` è„šæœ¬è®¾ç½®ä¸º `"husky install"`

* **ç”Ÿäº§ç¯å¢ƒé™åˆ¶**ï¼šRender çš„ç”Ÿäº§ç¯å¢ƒä¸­ `husky` å‘½ä»¤ä¸å¯ç”¨

* **è‡ªåŠ¨æ‰§è¡Œæœºåˆ¶**ï¼š`prepare` è„šæœ¬åœ¨ `npm install` æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œ

### æŠ€æœ¯èƒŒæ™¯

* **Husky ç”¨é€”**ï¼šä¸»è¦ç”¨äºæœ¬åœ°å¼€å‘ç¯å¢ƒçš„ Git hooks ç®¡ç†

* **ç”Ÿäº§ç¯å¢ƒéœ€æ±‚**ï¼šç”Ÿäº§ç¯å¢ƒé€šå¸¸ä¸éœ€è¦ Git hooks åŠŸèƒ½

* **éƒ¨ç½²ç¯å¢ƒå·®å¼‚**ï¼šæœ¬åœ°å¼€å‘ç¯å¢ƒä¸äº‘éƒ¨ç½²ç¯å¢ƒçš„å·¥å…·å¯ç”¨æ€§ä¸åŒ

## ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®æ”¹ prepare è„šæœ¬

**åŸå§‹é…ç½®ï¼š**

```json
"prepare": "husky install"
```

**ä¿®å¤åé…ç½®ï¼š**

```json
"prepare": "node -e \"try{require('husky').install()}catch(e){if(e.code!=='MODULE_NOT_FOUND')throw e}\""
```

### 2. ä¿®å¤åŸç†è¯´æ˜

**å®¹é”™æœºåˆ¶ï¼š**

* ä½¿ç”¨ `try-catch` åŒ…è£… husky å®‰è£…å‘½ä»¤

* å¦‚æœ husky æ¨¡å—ä¸å­˜åœ¨ï¼ˆ`MODULE_NOT_FOUND`ï¼‰ï¼Œé™é»˜è·³è¿‡

* å¦‚æœæ˜¯å…¶ä»–é”™è¯¯ï¼Œæ­£å¸¸æŠ›å‡ºå¼‚å¸¸

**å…¼å®¹æ€§ä¿è¯ï¼š**

* æœ¬åœ°å¼€å‘ç¯å¢ƒï¼šæ­£å¸¸å®‰è£…å’Œä½¿ç”¨ husky

* ç”Ÿäº§ç¯å¢ƒï¼šä¼˜é›…è·³è¿‡ husky å®‰è£…ï¼Œä¸å½±å“æ„å»º

## ä¿®å¤æ­¥éª¤è®°å½•

### æ‰§è¡Œçš„æ“ä½œ

1. **è¯†åˆ«é—®é¢˜**ï¼šåˆ†æ Render æ„å»ºæ—¥å¿—ï¼Œå®šä½åˆ° husky å‘½ä»¤æœªæ‰¾åˆ°

2. **æ£€æŸ¥é…ç½®**ï¼šæŸ¥çœ‹ `package.json` æ–‡ä»¶ä¸­çš„ `prepare` è„šæœ¬

3. **ä¿®æ”¹è„šæœ¬**ï¼šå°† `prepare` è„šæœ¬æ”¹ä¸ºå®¹é”™ç‰ˆæœ¬

4. **æäº¤æ›´æ”¹**ï¼š

   ```bash
   git add package.json
   git commit -m "Fix Render deployment: Skip husky install in production environment"
   ```

5. **æ¨é€ä»£ç **ï¼š

   ```bash
   git push origin main
   ```

### Git æäº¤ä¿¡æ¯

* **æäº¤å“ˆå¸Œ**ï¼š`dd1692ca`

* **æäº¤ä¿¡æ¯**ï¼š"Fix Render deployment: Skip husky install in production environment"

* **ä¿®æ”¹æ–‡ä»¶**ï¼š`package.json`ï¼ˆ1 è¡Œä¿®æ”¹ï¼‰

## éªŒè¯æ­¥éª¤

### 1. Render å¹³å°éªŒè¯

**è‡ªåŠ¨é‡æ–°éƒ¨ç½²ï¼š**

* Render æ£€æµ‹åˆ° GitHub ä»“åº“æ›´æ–°åä¼šè‡ªåŠ¨è§¦å‘é‡æ–°éƒ¨ç½²

* ç›‘æ§ Render æ§åˆ¶å°çš„æ„å»ºæ—¥å¿—

**é¢„æœŸç»“æœï¼š**

* æ„å»ºè¿‡ç¨‹ä¸­ä¸å†å‡ºç° husky ç›¸å…³é”™è¯¯

* `npm install && npm run build` å‘½ä»¤æˆåŠŸæ‰§è¡Œ

* åº”ç”¨æˆåŠŸå¯åŠ¨å¹¶é€šè¿‡å¥åº·æ£€æŸ¥

### 2. æœ¬åœ°ç¯å¢ƒéªŒè¯

**æµ‹è¯•å‘½ä»¤ï¼š**

```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules package-lock.json
npm install

# éªŒè¯æ„å»ºè¿‡ç¨‹
npm run build

# éªŒè¯å¯åŠ¨è¿‡ç¨‹
npm start
```

**é¢„æœŸç»“æœï¼š**

* æœ¬åœ°ç¯å¢ƒ husky åŠŸèƒ½æ­£å¸¸

* Git hooks æ­£å¸¸å·¥ä½œ

* æ„å»ºå’Œå¯åŠ¨è¿‡ç¨‹æ— é”™è¯¯

## åç»­éƒ¨ç½²æŒ‡å¯¼

### 1. ç›‘æ§ Render éƒ¨ç½²çŠ¶æ€

**æ£€æŸ¥é¡¹ç›®ï¼š**

* è®¿é—® Render æ§åˆ¶å°

* æŸ¥çœ‹æœ€æ–°éƒ¨ç½²çš„æ„å»ºæ—¥å¿—

* ç¡®è®¤æ„å»ºçŠ¶æ€ä¸º "Live"

**å…³é”®æŒ‡æ ‡ï¼š**

* æ„å»ºæ—¶é—´ï¼šé€šå¸¸ 2-5 åˆ†é’Ÿ

* å¥åº·æ£€æŸ¥ï¼š`/health` ç«¯ç‚¹å“åº”æ­£å¸¸

* æœåŠ¡çŠ¶æ€ï¼šæ˜¾ç¤ºä¸º "Running"

### 2. åŠŸèƒ½éªŒè¯æ¸…å•

**åŸºç¡€åŠŸèƒ½ï¼š**

* [ ] åº”ç”¨æˆåŠŸå¯åŠ¨

* [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹å¯è®¿é—®

* [ ] API ç«¯ç‚¹å“åº”æ­£å¸¸

* [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸

**æ ¸å¿ƒåŠŸèƒ½ï¼š**

* [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•

* [ ] æ ‡æ³¨åˆ›å»ºå’ŒæŸ¥çœ‹

* [ ] åœ°ç†ä½ç½®æœåŠ¡

* [ ] æ”¯ä»˜åŠŸèƒ½é›†æˆ

### 3. æ€§èƒ½ç›‘æ§

**ç›‘æ§æŒ‡æ ‡ï¼š**

* å“åº”æ—¶é—´ï¼š< 200ms

* å†…å­˜ä½¿ç”¨ï¼š< 512MB

* CPU ä½¿ç”¨ç‡ï¼š< 80%

* é”™è¯¯ç‡ï¼š< 1%

## å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### Q1: ä¿®å¤åä»ç„¶æ„å»ºå¤±è´¥

**å¯èƒ½åŸå› ï¼š**

* ç¼“å­˜é—®é¢˜

* å…¶ä»–ä¾èµ–é—®é¢˜

* ç¯å¢ƒå˜é‡ç¼ºå¤±

**è§£å†³æ–¹æ¡ˆï¼š**

1. åœ¨ Render æ§åˆ¶å°æ‰‹åŠ¨è§¦å‘é‡æ–°éƒ¨ç½²
2. æ£€æŸ¥æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡æ˜¯å¦å·²é…ç½®
3. æŸ¥çœ‹å®Œæ•´çš„æ„å»ºæ—¥å¿—ï¼Œè¯†åˆ«æ–°çš„é”™è¯¯ä¿¡æ¯

### Q2: æœ¬åœ°å¼€å‘ç¯å¢ƒ husky ä¸å·¥ä½œ

**æ£€æŸ¥æ­¥éª¤ï¼š**

```bash
# æ‰‹åŠ¨å®‰è£… husky
npx husky install

# æ£€æŸ¥ Git hooks
ls -la .git/hooks/

# é‡æ–°å®‰è£…ä¾èµ–
npm install
```

### Q3: éƒ¨ç½²æˆåŠŸä½†åº”ç”¨æ— æ³•è®¿é—®

**æ£€æŸ¥é¡¹ç›®ï¼š**

* ç¯å¢ƒå˜é‡é…ç½®

* å¥åº·æ£€æŸ¥è·¯å¾„è®¾ç½®

* ç«¯å£é…ç½®ï¼ˆç¡®ä¿ä½¿ç”¨ PORT ç¯å¢ƒå˜é‡ï¼‰

* æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²

## æœ€ä½³å®è·µå»ºè®®

### 1. å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒåˆ†ç¦»

**åŸåˆ™ï¼š**

* å¼€å‘å·¥å…·ï¼ˆå¦‚ huskyï¼‰åº”è¯¥ä¼˜é›…åœ°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é™çº§

* ä½¿ç”¨ç¯å¢ƒå˜é‡åŒºåˆ†ä¸åŒç¯å¢ƒçš„è¡Œä¸º

* é¿å…ç¡¬ç¼–ç ä¾èµ–ç‰¹å®šå·¥å…·çš„è„šæœ¬

### 2. éƒ¨ç½²å‰æµ‹è¯•

**å»ºè®®æµç¨‹ï¼š**

```bash
# æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒæ„å»º
NODE_ENV=production npm install --only=production
NODE_ENV=production npm run build
NODE_ENV=production npm start
```

### 3. æŒç»­ç›‘æ§

**ç›‘æ§ç­–ç•¥ï¼š**

* è®¾ç½® Render éƒ¨ç½²é€šçŸ¥

* é…ç½®åº”ç”¨æ€§èƒ½ç›‘æ§

* å®š

