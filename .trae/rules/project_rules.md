# SmellPin 项目规则文档

## 1. 项目概述

### 1.1 项目定位
SmellPin 是一个基于地理位置的搞笑恶搞标注平台，用户可以在地图上创建付费恶搞标注，其他用户通过LBS（基于位置的服务）获得奖励。

### 1.2 核心愿景
- 打造全球最大的搞笑恶搞地图平台
- 通过地理位置连接用户，创造有趣的社交体验
- 建立可持续的用户激励机制和商业模式

### 1.3 目标用户
- **主要用户群体**：18-35岁年轻人群
- **核心需求**：娱乐消遣、社交互动、轻松赚钱
- **使用场景**：日常通勤、旅游探索、朋友聚会

## 2. 技术架构总览

### 2.1 整体架构
```
前端层 (Frontend)
├── React PWA (主应用)
├── React Native (移动端)
└── React Admin (管理后台)

API网关层 (API Gateway)
├── Kong/Nginx (负载均衡)
└── CloudFlare (CDN + 安全)

微服务层 (Microservices)
├── Node.js (核心业务服务)
└── Python (数据分析服务)

数据层 (Data Layer)
├── PostgreSQL (主数据库)
├── Redis (缓存)
├── Elasticsearch (搜索)
└── MongoDB (日志存储)
```

### 2.2 技术栈选择原则
- **前端**：React生态系统，确保组件复用和开发效率
- **后端**：Node.js + TypeScript，保证类型安全和开发一致性
- **数据库**：PostgreSQL作为主库，Redis作为缓存层
- **部署**：云原生架构，支持水平扩展

## 3. 核心业务逻辑

### 3.1 付费恶搞标注系统
- **创建流程**：用户选择位置 → 填写内容 → 支付费用 → 发布标注
- **定价机制**：基于地理位置热度的动态定价
- **内容审核**：AI自动审核 + 人工复审机制

### 3.2 LBS奖励机制
- **触发条件**：用户进入标注地理围栏范围
- **奖励分配**：标注费用的一定比例分给发现者
- **防作弊**：GPS验证 + 行为分析

### 3.3 用户系统
- **认证方式**：手机号 + 验证码，支持第三方登录
- **用户等级**：基于活跃度和贡献度的等级系统
- **钱包系统**：支持充值、提现、交易记录

### 3.4 支付系统
- **支付方式**：支付宝、微信支付、PayPal
- **资金流向**：用户支付 → 平台托管 → 奖励分发
- **手续费**：平台收取5-10%手续费

## 4. 开发规范和约束

### 4.1 代码规范
- **语言标准**：TypeScript (ES2020+)
- **代码风格**：ESLint + Prettier统一格式化
- **命名规范**：
  - 组件：PascalCase (UserProfile.tsx)
  - 函数：camelCase (getUserInfo)
  - 常量：UPPER_SNAKE_CASE (API_BASE_URL)
  - 文件：kebab-case (user-service.ts)

### 4.2 组件设计原则
- **单一职责**：每个组件专注一个功能
- **组件大小**：单个组件不超过300行代码
- **复用性**：优先使用组合而非继承
- **状态管理**：使用Zustand进行全局状态管理

### 4.3 API设计规范
- **RESTful风格**：遵循REST API设计原则
- **版本控制**：URL路径包含版本号 (/api/v1/)
- **认证方式**：JWT Token + API Key
- **响应格式**：统一JSON格式，包含code、message、data字段

### 4.4 数据库设计约束
- **命名规范**：表名使用复数形式，字段名使用snake_case
- **索引策略**：为查询频繁的字段建立索引
- **数据完整性**：使用外键约束保证数据一致性
- **备份策略**：每日自动备份，保留30天历史数据

## 5. 安全和性能要求

### 5.1 安全要求
- **数据加密**：敏感数据使用AES-256加密存储
- **传输安全**：全站HTTPS，API使用TLS 1.3
- **输入验证**：所有用户输入进行严格验证和过滤
- **权限控制**：基于角色的访问控制(RBAC)

### 5.2 性能要求
- **响应时间**：API响应时间 < 200ms
- **并发处理**：支持10,000+并发用户
- **缓存策略**：Redis缓存热点数据，TTL设置合理
- **CDN加速**：静态资源使用CloudFlare CDN

### 5.3 可用性要求
- **系统可用性**：99.9%以上
- **容错机制**：服务降级和熔断保护
- **监控告警**：实时监控系统状态和性能指标
- **灾备方案**：多地域部署，自动故障转移

## 6. 部署和运维要求

### 6.0 数据库选择约束
- **强制要求**：必须使用Neon PostgreSQL作为生产数据库
- **禁止使用**：严格禁止使用Supabase作为项目数据库
- **技术原因**：确保数据库性能、安全性和可控性
- **替代方案**：如需更换数据库，只能选择其他PostgreSQL兼容的云数据库服务

### 6.1 部署环境
- **开发环境**：本地Docker容器
- **测试环境**：云服务器集群
- **生产环境**：
  - 前端：Vercel/Netlify
  - 后端：Cloudflare Workers
  - 数据库：Neon PostgreSQL（严格禁止使用Supabase）

### 6.2 CI/CD流程
- **代码提交**：Git Flow工作流
- **自动化测试**：单元测试 + 集成测试
- **部署流程**：自动化部署，支持回滚
- **环境管理**：环境变量统一管理

### 6.3 监控和日志
- **应用监控**：性能指标、错误率、响应时间
- **业务监控**：用户行为、交易数据、收入统计
- **日志管理**：结构化日志，集中存储和分析
- **告警机制**：关键指标异常时及时通知

## 7. 项目管理和协作

### 7.1 开发流程
- **需求管理**：PRD文档驱动开发
- **任务分配**：基于功能模块的任务拆分
- **代码审查**：所有代码必须经过Code Review
- **版本发布**：定期发布，遵循语义化版本控制

### 7.2 文档管理
- **技术文档**：API文档、架构设计文档
- **产品文档**：PRD、用户手册、运营指南
- **开发文档**：代码注释、README、部署指南
- **更新机制**：文档与代码同步更新

### 7.3 质量保证
- **测试策略**：单元测试覆盖率 > 80%
- **性能测试**：定期进行压力测试和性能优化
- **安全测试**：定期安全扫描和渗透测试
- **用户体验**：定期收集用户反馈并优化

## 8. 业务规则和约束

### 8.1 内容规范
- **禁止内容**：违法违规、恶意诽谤、色情暴力内容
- **审核机制**：AI预审 + 人工复审
- **举报处理**：用户举报 → 24小时内处理
- **违规处罚**：警告 → 限制功能 → 封号

### 8.2 交易规则
- **最小金额**：单次标注最低1元
- **最大金额**：单次标注最高1000元
- **手续费率**：平台收取5-10%手续费
- **提现规则**：最低提现10元，1-3个工作日到账

### 8.3 用户行为约束
- **防刷机制**：同一用户24小时内最多创建10个标注
- **地理限制**：标注创建需要在实际地理位置
- **奖励限制**：同一标注每个用户只能获得一次奖励
- **账号安全**：异常行为自动风控

---

**文档版本**：v1.0  
**最后更新**：2024年12月  
**维护责任人**：技术团队  
**审核状态**：已审核通过